/* eslint-disable @typescript-eslint/no-explicit-any */
import { Component, EventEmitter, forwardRef, Output } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { StarRating } from '../../services/star-rating';
import { StarRatingUtils } from '../../services/star-rating.utils';
import * as i0 from "@angular/core";
import * as i1 from "../../services/star-rating-config.service";
import * as i2 from "@angular/common";
const STAR_RATING_CONTROL_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => StarRatingControlComponent),
    multi: true,
};
export class StarRatingControlComponent extends StarRating {
    starClickChange = new EventEmitter();
    ratingChange = new EventEmitter();
    hoverRatingChange = new EventEmitter();
    // eslint-disable-next-line @typescript-eslint/ban-types
    onTouch;
    // eslint-disable-next-line @typescript-eslint/ban-types
    onModelChange;
    onModelChangeRegistered = false;
    onTouchRegistered = false;
    saveOnClick($event) {
        if (this.starClickChange) {
            this.starClickChange.emit($event);
        }
    }
    saveOnRatingChange($event) {
        if (this.ratingChange) {
            this.ratingChange.emit($event);
        }
    }
    saveOnHover($event) {
        if (this.hoverRatingChange) {
            this.hoverRatingChange.emit($event);
        }
    }
    saveOnTouch() {
        if (this.onTouchRegistered) {
            this.onTouch();
        }
    }
    saveOnModelChange(value) {
        if (this.onModelChangeRegistered) {
            this.onModelChange(value);
        }
    }
    /**ACCESSIBILITY **/
    //Keyboard events
    onKeyDown(event) {
        if (!this.interactionPossible()) {
            return;
        }
        const handlers = {
            //Decrement
            Minus: () => this.decrement(),
            ArrowDown: () => this.decrement(),
            ArrowLeft: () => this.decrement(),
            //Increment
            Plus: () => this.increment(),
            ArrowRight: () => this.increment(),
            ArrowUp: () => this.increment(),
            //Reset
            Backspace: () => this.reset(),
            Delete: () => this.reset(),
            Digit0: () => this.reset(),
        };
        const handleDigits = (eventCode) => {
            const dStr = 'Digit';
            const digit = parseInt(eventCode.substr(dStr.length, eventCode.length - 1), 10);
            this.rating = digit;
        };
        if (handlers[event['code']] ||
            StarRatingUtils.isDigitKeyEventCode(event['code'])) {
            if (StarRatingUtils.isDigitKeyEventCode(event['code'])) {
                handleDigits(event['code']);
            }
            else {
                handlers[event['code']]();
            }
            event.preventDefault();
            event.stopPropagation();
        }
        this.saveOnTouch();
    }
    //Focus events
    onBlur(event) {
        this.focus = false;
        event.preventDefault();
        event.stopPropagation();
        this.saveOnTouch();
    }
    onFocus(event) {
        this.focus = true;
        event.preventDefault();
        event.stopPropagation();
        this.saveOnTouch();
    }
    //Hover events
    onStarHover(rating) {
        if (!this.interactionPossible() || !this.hoverEnabled) {
            return;
        }
        this.hoverRating = rating ? parseInt(rating.toString(), 10) : 0;
        //fire onHoverRatingChange event
        const $event = { hoverRating: this.hoverRating };
        this.saveOnHover($event);
    }
    /**Form Control - ControlValueAccessor implementation**/
    writeValue(obj) {
        this.rating = obj;
    }
    registerOnChange(fn) {
        this.onModelChange = fn;
        this.onModelChangeRegistered = true;
    }
    registerOnTouched(fn) {
        this.onTouch = fn;
        this.onTouchRegistered = true;
    }
    constructor(config) {
        super(config);
    }
    //Overrides
    setRating(value) {
        const initValue = this.rating;
        super.setRating(value);
        //if value changed trigger valueAccessor events and outputs
        if (initValue !== this.rating) {
            const $event = { rating: this.rating };
            this.saveOnRatingChange($event);
            this.saveOnModelChange(this.rating);
        }
    }
    /**
     * onStarClicked
     *
     * Is fired when a star is clicked. And updated the rating value.
     * This function returns if the disabled or readOnly
     * property is set. If provided it emits the onClick event
     * handler with the actual rating value.
     *
     * @param rating
     */
    onStarClicked(rating) {
        //fire onClick event
        if (!this.interactionPossible()) {
            return;
        }
        this.rating = rating;
        const onClickEventObject = {
            rating: this.rating,
        };
        this.saveOnClick(onClickEventObject);
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.8", ngImport: i0, type: StarRatingControlComponent, deps: [{ token: i1.StarRatingConfigService }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.8", type: StarRatingControlComponent, selector: "star-rating-control", outputs: { starClickChange: "starClickChange", ratingChange: "ratingChange", hoverRatingChange: "hoverRatingChange" }, providers: [STAR_RATING_CONTROL_ACCESSOR], usesInheritance: true, ngImport: i0, template: "<div id=\"{{id}}\" class=\"rating {{getComponentClassNames()}}\" tabindex=\"0\"\n  (keydown)=\"onKeyDown($event)\" (blur)=\"onBlur($event)\"\n  (focus)=\"onFocus($event)\" (mouseleave)=\"onStarHover(0)\">\n  <div *ngIf=\"labelText\" class=\"label-value\">{{labelText}}</div>\n  <div class=\"star-container\">\n    <div class=\"star\" (mouseenter)=\"onStarHover(star)\"\n      *ngFor=\"let star of stars\" (click)=\"onStarClicked(star)\">\n      <i *ngIf=\"!svgVisible()\" class=\"star-empty {{classEmpty}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-half {{classHalf}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-filled {{classFilled}}\"></i>\n      <svg *ngIf=\"svgVisible()\" class=\"star-empty\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathEmpty\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-half\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathHalf\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-filled\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathFilled\"></use>\n      </svg>\n    </div>\n  </div>\n</div>\n", dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.8", ngImport: i0, type: StarRatingControlComponent, decorators: [{
            type: Component,
            args: [{ selector: 'star-rating-control', providers: [STAR_RATING_CONTROL_ACCESSOR], template: "<div id=\"{{id}}\" class=\"rating {{getComponentClassNames()}}\" tabindex=\"0\"\n  (keydown)=\"onKeyDown($event)\" (blur)=\"onBlur($event)\"\n  (focus)=\"onFocus($event)\" (mouseleave)=\"onStarHover(0)\">\n  <div *ngIf=\"labelText\" class=\"label-value\">{{labelText}}</div>\n  <div class=\"star-container\">\n    <div class=\"star\" (mouseenter)=\"onStarHover(star)\"\n      *ngFor=\"let star of stars\" (click)=\"onStarClicked(star)\">\n      <i *ngIf=\"!svgVisible()\" class=\"star-empty {{classEmpty}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-half {{classHalf}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-filled {{classFilled}}\"></i>\n      <svg *ngIf=\"svgVisible()\" class=\"star-empty\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathEmpty\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-half\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathHalf\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-filled\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathFilled\"></use>\n      </svg>\n    </div>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.StarRatingConfigService }]; }, propDecorators: { starClickChange: [{
                type: Output
            }], ratingChange: [{
                type: Output
            }], hoverRatingChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Rhci1yYXRpbmctY29udHJvbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItc3Rhci1yYXRpbmcvc3JjL2xpYi9jb21wb25lbnRzL3N0YXItcmF0aW5nLWNvbnRyb2wvc3Rhci1yYXRpbmctY29udHJvbC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItc3Rhci1yYXRpbmcvc3JjL2xpYi9jb21wb25lbnRzL3N0YXItcmF0aW5nLWNvbnRyb2wvc3Rhci1yYXRpbmctY29udHJvbC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx1REFBdUQ7QUFDdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RSxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFLekUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRXhELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7OztBQUVuRSxNQUFNLDRCQUE0QixHQUFHO0lBQ25DLE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQztJQUN6RCxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUM7QUFPRixNQUFNLE9BQU8sMEJBQ1gsU0FBUSxVQUFVO0lBSWxCLGVBQWUsR0FBNkIsSUFBSSxZQUFZLEVBQWMsQ0FBQztJQUczRSxZQUFZLEdBQW9DLElBQUksWUFBWSxFQUFxQixDQUFDO0lBR3RGLGlCQUFpQixHQUF5QyxJQUFJLFlBQVksRUFBMEIsQ0FBQztJQUVyRyx3REFBd0Q7SUFDeEQsT0FBTyxDQUFXO0lBQ2xCLHdEQUF3RDtJQUN4RCxhQUFhLENBQVc7SUFDaEIs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QjtrQkFMdEMsU0FBUzsrQkFDRSxxQkFBcUIsYUFDcEIsQ0FBQyw0QkFBNEIsQ0FBQzs4R0FRekMsZUFBZTtzQkFEZCxNQUFNO2dCQUlQLFlBQVk7c0JBRFgsTUFBTTtnQkFJUCxpQkFBaUI7c0JBRGhCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgZm9yd2FyZFJlZiwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IENsaWNrRXZlbnQgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2NsaWNrLWV2ZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBIb3ZlclJhdGluZ0NoYW5nZUV2ZW50IH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9ob3Zlci1yYXRpbmctY2hhbmdlLWV2ZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBSYXRpbmdDaGFuZ2VFdmVudCB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvcmF0aW5nLWNoYW5nZS1ldmVudC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU3RhclJhdGluZyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0YXItcmF0aW5nJztcbmltcG9ydCB7IFN0YXJSYXRpbmdDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3Rhci1yYXRpbmctY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3RhclJhdGluZ1V0aWxzIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3Rhci1yYXRpbmcudXRpbHMnO1xuXG5jb25zdCBTVEFSX1JBVElOR19DT05UUk9MX0FDQ0VTU09SID0ge1xuICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU3RhclJhdGluZ0NvbnRyb2xDb21wb25lbnQpLFxuICBtdWx0aTogdHJ1ZSxcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3N0YXItcmF0aW5nLWNvbnRyb2wnLFxuICBwcm92aWRlcnM6IFtTVEFSX1JBVElOR19DT05UUk9MX0FDQ0VTU09SXSxcbiAgdGVtcGxhdGVVcmw6ICdzdGFyLXJhdGluZy1jb250cm9sLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgU3RhclJhdGluZ0NvbnRyb2xDb21wb25lbnRcbiAgZXh0ZW5kcyBTdGFyUmF0aW5nXG4gIGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3JcbntcbiAgQE91dHB1dCgpXG4gIHN0YXJDbGlja0NoYW5nZTogRXZlbnRFbWl0dGVyPENsaWNrRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxDbGlja0V2ZW50PigpO1xuXG4gIEBPdXRwdXQoKVxuICByYXRpbmdDaGFuZ2U6IEV2ZW50RW1pdHRlcjxSYXRpbmdDaGFuZ2VFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFJhdGluZ0NoYW5nZUV2ZW50PigpO1xuXG4gIEBPdXRwdXQoKVxuICBob3ZlclJhdGluZ0NoYW5nZTogRXZlbnRFbWl0dGVyPEhvdmVyUmF0aW5nQ2hhbmdlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxIb3ZlclJhdGluZ0NoYW5nZUV2ZW50PigpO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG4gIG9uVG91Y2g6IEZ1bmN0aW9uO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xuICBvbk1vZGVsQ2hhbmdlOiBGdW5jdGlvbjtcbiAgcHJpdmF0ZSBvbk1vZGVsQ2hhbmdlUmVnaXN0ZXJlZCA9IGZhbHNlO1xuICBwcml2YXRlIG9uVG91Y2hSZWdpc3RlcmVkID0gZmFsc2U7XG5cbiAgc2F2ZU9uQ2xpY2soJGV2ZW50OiBDbGlja0V2ZW50KSB7XG4gICAgaWYgKHRoaXMuc3RhckNsaWNrQ2hhbmdlKSB7XG4gICAgICB0aGlzLnN0YXJDbGlja0NoYW5nZS5lbWl0KCRldmVudCk7XG4gICAgfVxuICB9XG5cbiAgc2F2ZU9uUmF0aW5nQ2hhbmdlKCRldmVudDogUmF0aW5nQ2hhbmdlRXZlbnQpIHtcbiAgICBpZiAodGhpcy5yYXRpbmdDaGFuZ2UpIHtcbiAgICAgIHRoaXMucmF0aW5nQ2hhbmdlLmVtaXQoJGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBzYXZlT25Ib3ZlcigkZXZlbnQ6IEhvdmVyUmF0aW5nQ2hhbmdlRXZlbnQpIHtcbiAgICBpZiAodGhpcy5ob3ZlclJhdGluZ0NoYW5nZSkge1xuICAgICAgdGhpcy5ob3ZlclJhdGluZ0NoYW5nZS5lbWl0KCRldmVudCk7XG4gICAgfVxuICB9XG5cbiAgc2F2ZU9uVG91Y2goKSB7XG4gICAgaWYgKHRoaXMub25Ub3VjaFJlZ2lzdGVyZWQpIHtcbiAgICAgIHRoaXMub25Ub3VjaCgpO1xuICAgIH1cbiAgfVxuXG4gIHNhdmVPbk1vZGVsQ2hhbmdlKHZhbHVlOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5vbk1vZGVsQ2hhbmdlUmVnaXN0ZXJlZCkge1xuICAgICAgdGhpcy5vbk1vZGVsQ2hhbmdlKHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICAvKipBQ0NFU1NJQklMSVRZICoqL1xuXG4gIC8vS2V5Ym9hcmQgZXZlbnRzXG4gIG9uS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblBvc3NpYmxlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBoYW5kbGVyczogYW55ID0ge1xuICAgICAgLy9EZWNyZW1lbnRcbiAgICAgIE1pbnVzOiAoKSA9PiB0aGlzLmRlY3JlbWVudCgpLFxuICAgICAgQXJyb3dEb3duOiAoKSA9PiB0aGlzLmRlY3JlbWVudCgpLFxuICAgICAgQXJyb3dMZWZ0OiAoKSA9PiB0aGlzLmRlY3JlbWVudCgpLFxuXG4gICAgICAvL0luY3JlbWVudFxuICAgICAgUGx1czogKCkgPT4gdGhpcy5pbmNyZW1lbnQoKSxcbiAgICAgIEFycm93UmlnaHQ6ICgpID0+IHRoaXMuaW5jcmVtZW50KCksXG4gICAgICBBcnJvd1VwOiAoKSA9PiB0aGlzLmluY3JlbWVudCgpLFxuXG4gICAgICAvL1Jlc2V0XG4gICAgICBCYWNrc3BhY2U6ICgpID0+IHRoaXMucmVzZXQoKSxcbiAgICAgIERlbGV0ZTogKCkgPT4gdGhpcy5yZXNldCgpLFxuICAgICAgRGlnaXQwOiAoKSA9PiB0aGlzLnJlc2V0KCksXG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZURpZ2l0cyA9IChldmVudENvZGU6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgZFN0ciA9ICdEaWdpdCc7XG4gICAgICBjb25zdCBkaWdpdDogbnVtYmVyID0gcGFyc2VJbnQoXG4gICAgICAgIGV2ZW50Q29kZS5zdWJzdHIoZFN0ci5sZW5ndGgsIGV2ZW50Q29kZS5sZW5ndGggLSAxKSxcbiAgICAgICAgMTBcbiAgICAgICk7XG4gICAgICB0aGlzLnJhdGluZyA9IGRpZ2l0O1xuICAgIH07XG5cbiAgICBpZiAoXG4gICAgICBoYW5kbGVyc1tldmVudFsnY29kZSddXSB8fFxuICAgICAgU3RhclJhdGluZ1V0aWxzLmlzRGlnaXRLZXlFdmVudENvZGUoZXZlbnRbJ2NvZGUnXSlcbiAgICApIHtcbiAgICAgIGlmIChTdGFyUmF0aW5nVXRpbHMuaXNEaWdpdEtleUV2ZW50Q29kZShldmVudFsnY29kZSddKSkge1xuICAgICAgICBoYW5kbGVEaWdpdHMoZXZlbnRbJ2NvZGUnXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVyc1tldmVudFsnY29kZSddXSgpO1xuICAgICAgfVxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIHRoaXMuc2F2ZU9uVG91Y2goKTtcbiAgfVxuXG4gIC8vRm9jdXMgZXZlbnRzXG4gIG9uQmx1cihldmVudDogRm9jdXNFdmVudCkge1xuICAgIHRoaXMuZm9jdXMgPSBmYWxzZTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuc2F2ZU9uVG91Y2goKTtcbiAgfVxuXG4gIG9uRm9jdXMoZXZlbnQ6IEZvY3VzRXZlbnQpIHtcbiAgICB0aGlzLmZvY3VzID0gdHJ1ZTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuc2F2ZU9uVG91Y2goKTtcbiAgfVxuXG4gIC8vSG92ZXIgZXZlbnRzXG4gIG9uU3RhckhvdmVyKHJhdGluZz86IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblBvc3NpYmxlKCkgfHwgIXRoaXMuaG92ZXJFbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5ob3ZlclJhdGluZyA9IHJhdGluZyA/IHBhcnNlSW50KHJhdGluZy50b1N0cmluZygpLCAxMCkgOiAwO1xuXG4gICAgLy9maXJlIG9uSG92ZXJSYXRpbmdDaGFuZ2UgZXZlbnRcbiAgICBjb25zdCAkZXZlbnQ6IEhvdmVyUmF0aW5nQ2hhbmdlRXZlbnQgPSB7IGhvdmVyUmF0aW5nOiB0aGlzLmhvdmVyUmF0aW5nIH07XG4gICAgdGhpcy5zYXZlT25Ib3ZlcigkZXZlbnQpO1xuICB9XG5cbiAgLyoqRm9ybSBDb250cm9sIC0gQ29udHJvbFZhbHVlQWNjZXNzb3IgaW1wbGVtZW50YXRpb24qKi9cblxuICB3cml0ZVZhbHVlKG9iajogYW55KTogdm9pZCB7XG4gICAgdGhpcy5yYXRpbmcgPSBvYmo7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uTW9kZWxDaGFuZ2UgPSBmbjtcbiAgICB0aGlzLm9uTW9kZWxDaGFuZ2VSZWdpc3RlcmVkID0gdHJ1ZTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG91Y2ggPSBmbjtcbiAgICB0aGlzLm9uVG91Y2hSZWdpc3RlcmVkID0gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogU3RhclJhdGluZ0NvbmZpZ1NlcnZpY2UpIHtcbiAgICBzdXBlcihjb25maWcpO1xuICB9XG5cbiAgLy9PdmVycmlkZXNcbiAgc2V0UmF0aW5nKHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBpbml0VmFsdWUgPSB0aGlzLnJhdGluZztcbiAgICBzdXBlci5zZXRSYXRpbmcodmFsdWUpO1xuXG4gICAgLy9pZiB2YWx1ZSBjaGFuZ2VkIHRyaWdnZXIgdmFsdWVBY2Nlc3NvciBldmVudHMgYW5kIG91dHB1dHNcbiAgICBpZiAoaW5pdFZhbHVlICE9PSB0aGlzLnJhdGluZykge1xuICAgICAgY29uc3QgJGV2ZW50OiBSYXRpbmdDaGFuZ2VFdmVudCA9IHsgcmF0aW5nOiB0aGlzLnJhdGluZyB9O1xuICAgICAgdGhpcy5zYXZlT25SYXRpbmdDaGFuZ2UoJGV2ZW50KTtcblxuICAgICAgdGhpcy5zYXZlT25Nb2RlbENoYW5nZSh0aGlzLnJhdGluZyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIG9uU3RhckNsaWNrZWRcbiAgICpcbiAgICogSXMgZmlyZWQgd2hlbiBhIHN0YXIgaXMgY2xpY2tlZC4gQW5kIHVwZGF0ZWQgdGhlIHJhdGluZyB2YWx1ZS5cbiAgICogVGhpcyBmdW5jdGlvbiByZXR1cm5zIGlmIHRoZSBkaXNhYmxlZCBvciByZWFkT25seVxuICAgKiBwcm9wZXJ0eSBpcyBzZXQuIElmIHByb3ZpZGVkIGl0IGVtaXRzIHRoZSBvbkNsaWNrIGV2ZW50XG4gICAqIGhhbmRsZXIgd2l0aCB0aGUgYWN0dWFsIHJhdGluZyB2YWx1ZS5cbiAgICpcbiAgICogQHBhcmFtIHJhdGluZ1xuICAgKi9cbiAgb25TdGFyQ2xpY2tlZChyYXRpbmc6IG51bWJlcik6IHZvaWQge1xuICAgIC8vZmlyZSBvbkNsaWNrIGV2ZW50XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aW9uUG9zc2libGUoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucmF0aW5nID0gcmF0aW5nO1xuXG4gICAgY29uc3Qgb25DbGlja0V2ZW50T2JqZWN0OiBDbGlja0V2ZW50ID0ge1xuICAgICAgcmF0aW5nOiB0aGlzLnJhdGluZyxcbiAgICB9O1xuICAgIHRoaXMuc2F2ZU9uQ2xpY2sob25DbGlja0V2ZW50T2JqZWN0KTtcbiAgfVxufVxuIiwiPGRpdiBpZD1cInt7aWR9fVwiIGNsYXNzPVwicmF0aW5nIHt7Z2V0Q29tcG9uZW50Q2xhc3NOYW1lcygpfX1cIiB0YWJpbmRleD1cIjBcIlxuICAoa2V5ZG93bik9XCJvbktleURvd24oJGV2ZW50KVwiIChibHVyKT1cIm9uQmx1cigkZXZlbnQpXCJcbiAgKGZvY3VzKT1cIm9uRm9jdXMoJGV2ZW50KVwiIChtb3VzZWxlYXZlKT1cIm9uU3RhckhvdmVyKDApXCI+XG4gIDxkaXYgKm5nSWY9XCJsYWJlbFRleHRcIiBjbGFzcz1cImxhYmVsLXZhbHVlXCI+e3tsYWJlbFRleHR9fTwvZGl2PlxuICA8ZGl2IGNsYXNzPVwic3Rhci1jb250YWluZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwic3RhclwiIChtb3VzZWVudGVyKT1cIm9uU3RhckhvdmVyKHN0YXIpXCJcbiAgICAgICpuZ0Zvcj1cImxldCBzdGFyIG9mIHN0YXJzXCIgKGNsaWNrKT1cIm9uU3RhckNsaWNrZWQoc3RhcilcIj5cbiAgICAgIDxpICpuZ0lmPVwiIXN2Z1Zpc2libGUoKVwiIGNsYXNzPVwic3Rhci1lbXB0eSB7e2NsYXNzRW1wdHl9fVwiPjwvaT5cbiAgICAgIDxpICpuZ0lmPVwiIXN2Z1Zpc2libGUoKVwiIGNsYXNzPVwic3Rhci1oYWxmIHt7Y2xhc3NIYWxmfX1cIj48L2k+XG4gICAgICA8aSAqbmdJZj1cIiFzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItZmlsbGVkIHt7Y2xhc3NGaWxsZWR9fVwiPjwvaT5cbiAgICAgIDxzdmcgKm5nSWY9XCJzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItZW1wdHlcIj5cbiAgICAgICAgPHVzZSB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgICAgIFthdHRyLnhsaW5rOmhyZWZdPVwicGF0aEVtcHR5XCI+PC91c2U+XG4gICAgICA8L3N2Zz5cbiAgICAgIDxzdmcgKm5nSWY9XCJzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItaGFsZlwiPlxuICAgICAgICA8dXNlIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiXG4gICAgICAgICAgW2F0dHIueGxpbms6aHJlZl09XCJwYXRoSGFsZlwiPjwvdXNlPlxuICAgICAgPC9zdmc+XG4gICAgICA8c3ZnICpuZ0lmPVwic3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWZpbGxlZFwiPlxuICAgICAgICA8dXNlIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiXG4gICAgICAgICAgW2F0dHIueGxpbms6aHJlZl09XCJwYXRoRmlsbGVkXCI+PC91c2U+XG4gICAgICA8L3N2Zz5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==